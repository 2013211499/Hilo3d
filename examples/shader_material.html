<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Hilo3d ShaderMaterial Demo</title>
    <link rel="stylesheet" type="text/css" href="./example.css">
</head>
<body>
<div id="container"></div>
<script src="../build/Hilo3d.js"></script>
<script src="./js/stats.js"></script>
<script src="./js/OrbitControls.js"></script>
<script src="./js/init.js"></script>
<script>
    var container = new Hilo3d.Node();
    var geometry = new Hilo3d.SphereGeometry({
        radius: 1,
        heightSegments: 32,
        widthSegments: 64,
    })
    var mesh = new Hilo3d.Mesh({
        b:0,
        v:0.05,
        geometry: geometry,
        material: new Hilo3d.ShaderMaterial({
            diffuse: new Hilo3d.LazyTexture({
                crossOrigin: true,
                src: '//gw.alicdn.com/tfs/TB1VUmoQFXXXXcjXFXXXXXXXXXX-1500-750.jpg'
            }),
            uniforms:{
                u_diffuse:'DIFFUSE',
                u_modelViewProjectionMatrix:'MODELVIEWPROJECTION',
                u_b:{
                    get:function(mesh, material, programInfo){
                        return mesh.b;
                    }
                }
            },
            attributes:{
                a_position: 'POSITION',
                a_texcoord0:'TEXCOORD_0'
            },
            fs:`
                precision highp float;
                varying vec2 v_texcoord0;
                uniform sampler2D u_diffuse;
                uniform float u_b;

                void main(void) {
                    vec4 diffuse = texture2D(u_diffuse, v_texcoord0);    
                    gl_FragColor = vec4(diffuse.gr, u_b, 1.0);
                }
            `,
            vs:`
                precision highp float;
                attribute vec3 a_position;
                attribute vec2 a_texcoord0;
                uniform mat4 u_modelViewProjectionMatrix;
                varying vec2 v_texcoord0;

                void main(void) {
                    vec4 pos = vec4(a_position, 1.0);
                    gl_Position = u_modelViewProjectionMatrix * pos;
                    v_texcoord0 = a_texcoord0;
                }
            `
        }),
        onUpdate(){
            this.b += this.v;
            if(this.b > 1 || this.b < 0){
                this.v *= -1;
            }
        }
    });
    container.addChild(mesh);
    stage.addChild(container);


</script>
</body>
</html>